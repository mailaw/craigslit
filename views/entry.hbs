

<!DOCTYPE html>
<html class="no-js">
  <head>
  <title>craigslist: CH</title>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="craigslist provides local classifieds and forums for jobs, housing, for sale, personals, services, local community, and events">

  <meta name="ICBM" content="35.771900, -78.638901">
  	<meta name="twitter:card" content="preview">
  	<meta property="og:site_name" content="craigslit">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link type="text/css" rel="stylesheet" media="all" href="https://www.craigslist.org/styles/cl.css?v=f2b739aac0ce30a61818c1630276321d">
  <link href="../public/stylesheets/style.css" rel="stylesheet">

  <link type="text/css" rel="stylesheet" media="all" href="https://www.craigslist.org/styles/homepage.css?v=dcfbe053aaf12ea02fc380ffc5dfe58d">
  <link type="text/css" rel="stylesheet" media="all" href="https://www.craigslist.org/styles/jquery-ui-clcustom.css?v=3b05ddffb7c7f5b62066deff2dda9339">
  <link rel="prefetch" href="https://www.craigslist.org/js/search-concat.min.js?v=c9fa94548a136143f2b7cd5c0247e0ce">
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="uploadPicture.js" type="text/javascript" ></script>


  </head>

    <script>
        $(document).ready(function(){
            $.ajax({
                type: 'GET',
                crossDomain: true,
                url: "http://localhost:3000/getPost",
                success: function(result){
                    $("#container").html("");
                    for(var i = 0; i < result.length;i++){
                        var obj = result[i].img.data;
                        var img = "data:image/jpeg;base64,"+obj.slice(0, -1);
                        $("#container").append("<img class='picture'src='"+img+"'/>");
                    }
                }});
        });
        function getPost(cat){
            console.log("CATEGORY="+ cat)
            $.ajax({
                type: 'GET',
                crossDomain: true,
                url: "http://localhost:3000/getPost?category="+cat,
                success: function(result){
                    $("#container").empty();
                    $("#container").html("");
                    for(var i = 0; i < result.length;i++){
                        var obj = result[i].img.data;
                        var img = "data:image/jpeg;base64,"+obj.slice(0, -1);
                        $("#container").append("<img class='picture'src='"+img+"'/>");
                    }
                }
            });
        }
    </script>

    <script>
      $(document).ready(function() {
          $('#entry_title').on('input', function() {
            var input=$(this);
            var is_name=input.val();
            if(is_name){input.removeClass("invalid").addClass("valid");}
            else{input.removeClass("valid").addClass("invalid");}
          });

          $('#entry_email').on('input', function() {
            var input=$(this);
            var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
            var is_email=re.test(input.val());
            if(is_email){input.removeClass("invalid").addClass("valid");}
            else{input.removeClass("valid").addClass("invalid");}
          });

          $('#entry_phone').on('input', function() {
            var input=$(this);
            var is_name=input.val();
            if(is_name){input.removeClass("invalid").addClass("valid");}
            else{input.removeClass("valid").addClass("invalid");}
          });

          $('#entry_PostingBody').keyup(function(event) {
            var input=$(this);
            var is_name=input.val();
            if(is_name){input.removeClass("invalid").addClass("valid");}
            else{input.removeClass("valid").addClass("invalid");}
            // var message=$(this).val();
            // console.log(message);
            // if(message){input.removeClass("invalid").addClass("valid");}
            // else{input.removeClass("valid").addClass("invalid");}
          });
          $('#entry_category').keyup(function(event) {
            var input=$(this);
            var is_name=input.val();
            if(is_name){input.removeClass("invalid").addClass("valid");}
            else{input.removeClass("valid").addClass("invalid");}
          });


        <!-- After Form Submitted Validation-->
        $("#entry_button button").click(function(event){
          var form_data=$("#entry").serializeArray();
          var error_free=true;
          for (var input in form_data){
            var element=$("#entry_"+form_data[input]['name']);
            var valid=element.hasClass("valid");
            var error_element=$("span", element.parent());
            if (!valid){error_element.removeClass("error").addClass("error_show"); error_free=false;}
            else{error_element.removeClass("error_show").addClass("error");}
          }
          if (!error_free){
            event.preventDefault();
          }
          else{
            alert('No errors: Form will be submitted');
          }
        });
      });
    </script>


<body class="homepage en">
<script type="text/javascript"><!--
    function C(k){return(document.cookie.match('(^|; )'+k+'=([^;]*)')||0)[2]}
    var pagetype, pagemode;
    (function(){
        var h = document.documentElement;
        h.className = h.className.replace('no-js', 'js');
        var b = document.body;
        var bodyClassList = b.className.split(/\s+/);;
        pagetype = bodyClassList[0]; // dangerous assumption
        var fmt = C('cl_fmt');
        if ( fmt === 'regular' || fmt === 'mobile' ) {
            pagemode = fmt;
        } else if (screen.width <= 480) {
            pagemode = 'mobile';
        } else {
            pagemode = 'regular';
        }
        pagemode = pagemode === 'mobile' ? 'mobile' : 'desktop';
        bodyClassList.push(pagemode);
        if (C('hidesearch') === '1' && pagemode !== 'mobile') {
            bodyClassList.push('hide-search');
        }
        var width = window.innerWidth || document.documentElement.clientWidth;
        if (width > 1000) { bodyClassList.push('w1024'); }
        if (typeof window.sectionBase !== 'undefined') {
            var mode = (decodeURIComponent(C('cl_tocmode') || '').match(new RegExp(window.sectionBase + ':([^,]+)', 'i')) || {})[1] || window.defaultView;
            if (mode) {
                bodyClassList.push(mode);
            }
        }
        b.className = bodyClassList.join(' ');
    }());
--></script>

 <div>
  <section class="page-container">
      <nav id="topban" class="regular">
          <div class="regular-area">
              <h2 class="area"><a href="\">chapel hill</a></h2>
          </div>
      </nav>
  </section>

  <div class="center-div">
      <form id="entry" method="post" action="/savePost">
          <!-- Title -->
          <div>
            <input type="radio" name="entry_category" value="personals">Personals
            <input type="radio" name="entry_category" value="forsale">Free and For Sale
          </div>
          <div>
            <!--label for="title">posting title:</label-->
            <input id="entry_title" name="title" type="text" maxlength="70" placeholder="posting title"></input>
            <span class="error">This field is required</span>
            <input id="entry_price" name="price" type="text" maxlength="20" placeholder="price">
            <span class="error">This field is required</span>
          </div>
          <!-- Email-->
          <div>
        		<!--label for="email">Email:</label-->
        		<input type="email" id="entry_email" name="email" value="" placeholder="email"></input>
        		<span class="error">A valid email address is required</span>
        	</div>
          <!-- Phone -->
          <div>
        		<!--label for="phone">Website:</label-->
        		<input type="phone" id="entry_phone" name="phone"></input>
        		<span class="error">A valid phone number is required</span>
        	</div>
          <!-- Description -->
          <div>
            <textarea class="req" tabindex="1" rows="20" cols="60" id="entry_PostingBody" name="PostingBody" placeholder="posting body"></textarea>
            <span class="error">Description is required</span>
          </div>

          <div>
            <input type="file" name=img id="upload" accept="image/jpeg,image/png,image/gif">
          </div>


          <div id="entry_submit">
            <button type="submit" onclick="getJpg()">Submit</button>
          </div>
      </form>
  </div>
</div>

    <script>
    function getJpg(){
    	var upload = document.getElementById("upload");
      if ('files' in upload) { //has name, type, and size
          if (upload.files.length == 0) {
              alert("Choose one or more files");
          } else {
              for (var i = 0; i < upload.files.length; i++) {
                var file = upload.files[i];
                //console.log('file yo', file)
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(){
                  console.log("READER RESULT", reader.result)
                  // var result = reader.result.replace("data:"+ file.type +";base64,", '');
                  savePost(reader.result);
                };
              }
          }
      }
    };

    function savePost(dataObject){
      let title = $("#entry_title").val()
      let description = $('#entry_PostingBody').val()
      let email = $('#entry_email').val()
      let phone = $('#entry_phone').val()
      let category = $("input:radio[name=entry_category]:checked").val();
      let price = $("#entry_price").val()
      console.log("saving this post to db\n", title, description, email, phone, category,price, "\n")
      console.log("Description ENTRY,HBS", description)
      $.ajax({
          method: 'POST',
          url: "http://localhost:3000/savePost",
          contentType: 'application/json',
          data: JSON.stringify(
            {"img": dataObject, 
            "title": title, 
            "description": description, 
            "email": email, 
            "phone": phone, 
            "category": category, 
            "price": price}
          ),
          crossDomain: true,
          dataType: 'json',
          //dataType: 'json',
          success: function(data) {
            console.log("post saved~ ");
          },
          error: function(err){
            console.log("couldn't save post", err);
          }
    	})
      window.location = 'feed/'+category
    };
    </script>
  </body>
</html>
